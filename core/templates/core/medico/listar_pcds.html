{% extends 'base.html' %}

{% block title %}Avaliar PCDs - Portal PCD{% endblock %}

{% block body %}
<div class="min-h-screen bg-gray-100">
  <!-- Header -->
  <header class="bg-purple-700 text-white p-4 shadow-lg">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-2xl font-bold">Avalia√ß√£o de PCDs</h1>
      <a href="{% url 'dashboard_medico' %}" class="bg-purple-900 hover:bg-purple-800 px-4 py-2 rounded">‚Üê Voltar ao Dashboard</a>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container mx-auto p-6">
    <!-- Mensagens -->
    {% if messages %}
      {% for message in messages %}
        <div class="mb-4 p-4 rounded {% if message.tags == 'success' %}bg-green-100 text-green-800{% elif message.tags == 'error' %}bg-red-100 text-red-800{% else %}bg-blue-100 text-blue-800{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <!-- Filters -->
    <div class="bg-white rounded-lg shadow-md p-4 mb-6">
      <form method="get" class="flex gap-4 items-center">
        <label class="font-semibold">Filtrar por Status:</label>
        <select name="status" class="border border-gray-300 rounded px-4 py-2" onchange="this.form.submit()">
          <option value="pendente" {% if status_filter == 'pendente' %}selected{% endif %}>‚è≥ Pendente</option>
          <option value="enquadravel" {% if status_filter == 'enquadravel' %}selected{% endif %}>‚úÖ Enquadr√°vel</option>
          <option value="sugestivo" {% if status_filter == 'sugestivo' %}selected{% endif %}>‚ö†Ô∏è Sugestivo</option>
          <option value="nao_enquadravel" {% if status_filter == 'nao_enquadravel' %}selected{% endif %}>üö´ N√£o Enquadr√°vel</option>
          <option value="avaliacao_adicional" {% if status_filter == 'avaliacao_adicional' %}selected{% endif %}>ü©∫ Avalia√ß√£o Adicional</option>
          <option value="necessita_laudo" {% if status_filter == 'necessita_laudo' %}selected{% endif %}>üìÑ Necessita Laudo</option>
          <option value="todos" {% if status_filter == 'todos' %}selected{% endif %}>Todos</option>
        </select>
      </form>
    </div>

    <!-- PCDs List -->
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
      <table class="w-full">
        <thead class="bg-purple-600 text-white">
          <tr>
            <th class="px-4 py-3 text-left">Nome</th>
            <th class="px-4 py-3 text-left">CPF</th>
            <th class="px-4 py-3 text-left">Defici√™ncias</th>
            <th class="px-4 py-3 text-left">Status</th>
            <th class="px-4 py-3 text-left">Data Cadastro</th>
            <th class="px-4 py-3 text-center">A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          {% for perfil in perfis %}
            <tr class="border-b hover:bg-gray-50">
              <td class="px-4 py-3">{{ perfil.pcd_profile.nome_completo|default:perfil.pcd_profile.user.username }}</td>
              <td class="px-4 py-3">{{ perfil.pcd_profile.cpf }}</td>
              <td class="px-4 py-3">
                {% for def in perfil.pcd_profile.deficiencias.all %}
                  <span class="inline-block bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs mr-1">
                    {{ def.nome }}
                  </span>
                {% empty %}
                  <span class="text-gray-400">N√£o informado</span>
                {% endfor %}
              </td>
              <td class="px-4 py-3">
                <span class="inline-block px-3 py-1 rounded text-sm font-semibold
                  {% if perfil.status_medico == 'pendente' %}bg-yellow-100 text-yellow-800
                  {% elif perfil.status_medico == 'enquadravel' %}bg-green-100 text-green-800
                  {% elif perfil.status_medico == 'sugestivo' %}bg-orange-100 text-orange-800
                  {% elif perfil.status_medico == 'nao_enquadravel' %}bg-red-100 text-red-800
                  {% elif perfil.status_medico == 'avaliacao_adicional' %}bg-blue-100 text-blue-800
                  {% elif perfil.status_medico == 'necessita_laudo' %}bg-purple-100 text-purple-800
                  {% endif %}">
                  {{ perfil.get_status_medico_display }}
                </span>
              </td>
              <td class="px-4 py-3">{{ perfil.pcd_profile.criado_em|date:"d/m/Y" }}</td>
              <td class="px-4 py-3 text-center">
                <a href="{% url 'avaliar_pcd' perfil.pcd_profile.id %}"
                   class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded inline-block">
                  {% if perfil.status_medico == 'pendente' %}Avaliar{% else %}Ver/Editar{% endif %}
                </a>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="6" class="px-4 py-8 text-center text-gray-500">
                Nenhum PCD encontrado com esse filtro.
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </main>
</div>
{% endblock %}
